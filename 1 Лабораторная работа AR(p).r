#–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ AR(1), –∏–∑ ùëõ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π, –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ Teta
n = 1000
set.seed(123)
E = rnorm(n,0,1)
Teta = 0.5
Teta_2 = 0.2

#–§—É–Ω–∫—Ü–∏—è,–≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –∑–Ω–∞—á–µ–Ω–∏—è AR(1) –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è Teta
AR = function(Teta) 
{x_1 = numeric(n) #–Ω—É–ª–µ–≤–æ–π –≤–µ–∫—Ç–æ—Ä –¥–ª–∏–Ω—ã n.
 x_1[1] = E[1]
 for (i in 2:n){x_1[i]=Teta*x_1[i-1] + E[i]}
 return(x_1)
}
ar_1 = AR(0.5)
plot(ar_1, type='l')
#–ì—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π Teta
par(mfrow=c(3,1))
plot(AR(0.5), type='l', col='blue', main=paste("AR(1) (Teta=", 0.5, ")"))
plot(AR(1), type='l', col='red', main=paste("AR(1) (Teta=", 1, ")"))
plot(AR(1.5), type='l', col='purple', main=paste("AR(1) (Teta=", 1.5, ")"))

#–§—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –∑–Ω–∞—á–µ–Ω–∏—è AR(1) –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è Teta –∏ –æ–±—ä—ë–º–∞ –≤—ã–±–æ—Ä–∫–∏ k
AR_k = function(Teta, k) 
{x_2 = numeric(k)
 x_2[1] = E[1]
 for (i in 2:k){x_2[i] = Teta*x_2[i-1] + E[i]}
 return(x_2)
}

#–ú–ù–ö-–æ—Ü–µ–Ω–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π k
Teta_k = numeric(n-9)
for (k in 10:n) 
{y = AR_k(Teta, k)
 X = cbind(y[1:(k-1)], rep(1, k-1))
 Teta_k[k-9] = solve(t(X) %*% X) %*% t(X) %*% y[-1]
}

plot(10:n, Teta_k, type='l', col='blue', main='–û—Ü–µ–Ω–∫–∞ Teta –ø–æ —Ä–∞–∑–º–µ—Ä—É –≤—ã–±–æ—Ä–∫–∏', xlab='–†–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏', ylab='–û—Ü–µ–Ω–∫–∞ Teta')

#–û—Ü–µ–Ω–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ Teta –º–µ—Ç–æ–¥–æ–º –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ (–ú–ù–ö)
y = AR(Teta)
X = cbind(AR(Teta)[1:(n-1)], rep(1, n-1))
Teta_k = solve(t(X) %*% X) %*% t(X) %*% y[-1]; Teta_k

plot(y, type='l', col='blue', main='AR(1) –ø—Ä–æ—Ü–µ—Å—Å –∏ —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–∞—è –ø—Ä—è–º–∞—è')
abline(Teta_k, 0)

#–û—Ü–µ–Ω–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–∏—è(–ú–ü) –¥–ª—è Teta
MP = function(Teta, y) {return(-sum(dnorm(y[-1] - Teta*y[-n], log = TRUE)))}
Teta_mp = optimize(MP, interval=c(-1, 1), y=AR(Teta)); Teta_mp

MP=function(Teta)
{sum=0
for(i in 2:100){sum=sum+(ar_1[i]-Teta*ar_1[i-1])^2}
return(sum)
}
MP_1 = optimize(f= MP, interval = c(-1,1));MP_1

#–ì—Ä–∞—Ñ–∏–∫ AR(1) –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏ —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–π –ø—Ä—è–º–æ–π
plot(y, type='l', col='blue', main='AR(1) –ø—Ä–æ—Ü–µ—Å—Å –∏ –æ—Ü–µ–Ω–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–∏—è')
abline(Teta_ml$minimum, 0)

#–í—ã–≤–æ–¥ –æ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∏ –æ—Ü–µ–Ω–æ–∫ –ú–ù–ö –∏ –ú–ü –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ ùúÉ –≤ —Å–ª—É—á–∞–µ –≥–∞—É—Å—Å–æ–≤—Å–∫–æ–≥–æ —à—É–º–∞.
#–í —Å–ª—É—á–∞–µ –≥–∞—É—Å—Å–æ–≤—Å–∫–æ–≥–æ —à—É–º–∞ –æ—Ü–µ–Ω–∫–∏ –ú–ù–ö –∏ –ú–ü –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ ùúÉ —Å–æ–≤–ø–∞–¥–∞—é—Ç, 
#—Ç.–∫. –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–∏—è –∏–º–µ–µ—Ç –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω—É—é —Ñ–æ—Ä–º—É.

#–ú–ù–ö-–æ—Ü–µ–Ω–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π k
Teta_k = numeric(n-9)
for (k in 10:n) 
  {y = AR_k(Teta, k)
   X = cbind(y[1:(k-1)], rep(1, k-1))
   Teta_k[k-9] = solve(t(X) %*% X) %*% t(X) %*% y[-1]
  }

plot(10:n, Teta_k, type='l', col='blue', main='–û—Ü–µ–Ω–∫–∞ Teta –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±—ä—ë–º–∞ –≤—ã–±–æ—Ä–∫–∏', xlab='–†–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏', ylab='–û—Ü–µ–Ω–∫–∞ Teta')

#–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ —É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ ùê¥ùëÖ(2), –∏–∑ ùëõ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π.
#–§—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –∑–Ω–∞—á–µ–Ω–∏—è AR(2) –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è –∑–∞–¥–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π Teta –∏ Teta_2
AR_2 = function(Teta, Teta_2) 
{x_2 = numeric(n)
 x_2[1:2] = E[1:2]
 for (i in 3:n) {x_2[i] = Teta * x_2[i-1] + Teta_2 * x_2[i-2] + E[i]}
 return(x_2)
}
plot(AR_2(Teta, Teta_2), col='violet',type='l', main='–ü—Ä–æ—Ü–µ—Å—Å AR(2)')

#–í—ã—á–∏—Å–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ ùê¥ùëÖ(2), –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é ùëéùëüùëñùëöùëé –ø–∞–∫–µ—Ç–∞ ùë†ùë°ùëéùë°ùë†.
library("stats")
p=2;d=0;q=0
arima_model = arima(AR_2(Teta, Teta_2), order=c(p,d,q),include.mean =  FALSE)
arima_model$coef

arima(AR_2(Teta, Teta_2), order=c(p,d,q),include.mean =  FALSE)
